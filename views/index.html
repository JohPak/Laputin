<!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Hintalaputin - Lantahiputin</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Libre+Barcode+EAN13+Text&display=swap" rel="stylesheet">
        <link href="/styles/style.css" rel="stylesheet">
        <link rel="icon" type="image/png" href="/img/favicon.png" sizes="32x32">
  
      
    </head>
    <body>
        
        <script>
            let d = new Date();
            let year = d.getFullYear();
            </script>

<div class="menubar noprint">
        <div class="huomio noprint">Päivitys 5.2.2023 - tuotteiden lisäkuvat ja uutuus-lätkä</div>

            <fieldset class="noprint">
                <form action="/hae" method="post" class="noprint">
                    <input type="text" class="noprint" name="urlinput" value="{url}" onclick="this.select()" title="Syötä tuotteen www-osoite ja paina Nouda tiedot -painiketta.">
                    <button type="submit" title="Syötä tuotteen www-osoite (Minimanin verkkokaupasta) ja paina Nouda tiedot -painiketta." class="noprint" style="width: 130px;">
                        <span class="material-icons-outlined">arrow_downward</span>Nouda tiedot
                    </button>
                </form> 
                
                <br>   
                <!-- PAINIKERIVI -->
                <!-- ************************************************** -->
                <button onclick="window.print()" title="Tulosta"><span class="material-icons">print</span>Tulosta</button>
                
                <button onclick="tulostareunat()" title="Valitse tämä tulostaaksesi mustien kehysten kanssa" class="btn-harmaa"><span id="tulostareunatcheckbox" class="material-icons">check_box_outline_blank</span>Tulosta kehykset</button>
                
                <button onclick="naytaviivakoodi()" title="Näytä ean viivakoodina" class="btn-harmaa"><span id="naytaviivakoodicheckbox" class="material-icons">check_box_outline_blank</span>Näytä viivakoodi</button>
                
                <button onclick="kaanna()" title="Käännä kuvaa 90° kerrallaan"><span class="material-icons">rotate_right</span>Käännä</button>
                
                
                <button onclick="vaihdaKuvanUrl()" title="Muokkaa kuvan url-osoitetta" class="btn-harmaa"><span class="material-icons">link</span>Kuvan URL</button>
                
                <!-- <fieldset class="fs-skaalaus">
                    <legend>Esikatselu</legend>     -->
                    <button onclick="skaalaaesikatselua(1.10)" title="Suurenna esikatselua"><span class="material-icons">add</span></button>
                    <button onclick="skaalaaesikatselua(0.90)" title="Pienennä esikatselua"><span class="material-icons">remove</span></button>
                    <!-- </fieldset> -->
                
                <div class="jakaja"></div>    
                
                <button onclick="naytauutuus()" title="Näytä Uutuus-lätkä" class="btn-harmaa"><span id="naytauutuuscheckbox" class="material-icons">check_box_outline_blank</span>Uutuus</button>
                    
                <button onclick="alert(`© Johanna Pakkala ${year} (päivitetty 5.2.2023) \n\n Ongelmatilanteissa, kysymyksissä tai kehitysehdotuksissa ota yhteyttä johanna.pakkala@minimani.fi`)" title="Info" class="btn-harmaa btn-oikea"><span class="material-icons-outlined">info</span>Info</button>
                    

                    <!-- SLIDERIT  -->
                    <!-- ************************************************** -->
                    
                    <div class="sliderdiv">
                        <div class="testi noprint">
                            <label class="sliderteksti">Tuotekuvan koko</label>
                            <input type="range" min="0" max="90" value="{tuotekuvankoko}" class="slider" id="myRange" title="Säädä tuotekuvan kokoa">
                        </div>
                        
                        <div class="testi noprint">
                            <label class="sliderteksti" for="kuvakorkeus">Tuotekuvan sijainti</label>
                            <input type="range" min="-100" max="100" value="{tuotekuvansijainti}" class="slider" id="kuvakorkeus">
                        </div>
                        
                        <div class="testi noprint">
                            <label class="sliderteksti">Tekstin sijainti</label>
                            <input type="range" min="-30" max="90" value="{tekstinsijainti}" class="slider" id="slidertekstikorkeus">
                        </div>
                        
                        <div class="testi noprint">
                            <label class="sliderteksti">Tuotetietojen koko</label>
                            <input type="range" min="0.85" max="1.8" value="{tuotetietojenkoko}" class="slider" id="sliderkuvausteksti" step="0.005">
                        </div>
                    </div>
                    
            </fieldset>        
                
        </div>  
        
    <div class="spacer">
        
        &nbsp;
    </div>
            
    <div class="noprint" id="lisakuvat"><p>Lisäkuvat: </p></div>
    <div class="tausta" tabindex="-1" title="Klikkaa tekstiä muokataksesi sitä">
        <!-- <div class="taustakuva noprint" tabindex="-1"> -->
        <div class="taustakuva noprint">
            <img src="/img/kehys.png" id="taustakuva">
        </div>
        <!-- <div class="sivu" tabindex="-1"> -->
        <div class="sivu">
            <div class="uutuus"><img src="/img/uutuus.png" title="Uutuus-tuote"></div>
            <!-- <div class="kuva" tabindex="-1"> -->
            <div class="kuva" tabindex="-1">
                <img src="https://www.minimani.fi/media/catalog/product/placeholder/default/minimaniph.png" id="kuvakoko">
            </div>

            <div class="tuote tekstit" contenteditable="true" tabindex="1" style="margin-top: 0vh;" title="Klikkaa muokataksesi tekstiä">{tuote}</div>
            <div class="ean tekstit" contenteditable="true" tabindex="2" title="Klikkaa muokataksesi ean-koodia">{ean}</div>
            <div class="hinta tekstit" contenteditable="true" tabindex="3" title="Klikkaa muokataksesi hintaa">{hinta}
                <div class="sulkuhinta" contenteditable="true" tabindex="3" title="Klikkaa muokataksesi sulkuhintaa">{sulkuhinta}</div>
            </div>
            <div class="kuvaus tekstit" contenteditable="true" tabindex="5" title="Klikkaa muokataksesi tekstiä">{kuvaus}</div>
            <div class="viivakoodi tekstit" contenteditable="true" tabindex="4" title="Klikkaa muokataksesi ean-koodia">{viivakoodi}</div>
            </div>
        </div> 

        <script>
            var slider = document.getElementById("myRange");
            var sliderKuvakorkeus = document.getElementById("kuvakorkeus"); 
            var sliderTekstikorkeus = document.getElementsByClassName("tuote")[0];
            var sliderKuvausteksti = document.getElementsByClassName("kuvaus");
            var output = document.getElementById("kuvakoko"); //haetaan kuva
            var outputKuvakorkeus = document.getElementById("kuvakoko");
            var outputTekstikorkeus = document.getElementsByClassName("tuote")[0];
            var outputKuvausteksti = document.getElementsByClassName("kuvaus")[0];
            output.style.width = slider.value; // Display the default slider value
            outputKuvakorkeus.style.marginTop = sliderKuvakorkeus.value; // Display the default slider value
            outputTekstikorkeus.style.marginTop = sliderTekstikorkeus.value; // Display the default slider value
            outputKuvausteksti.style.fontSize = sliderKuvausteksti.value; // Display the default slider value

            // URL PARAMETRIT
                // let urli = new URL('https://example.com?foo=1&bar=2');
                // let urli = window.location.href; // current url
                // let params = new URLSearchParams(urli.search);
                // let urlisyote = document.getElementsByName("urlinput")[0].value; // user inputted product url
                //     params.set('url', urlisyote);



                // https://www.sitepoint.com/get-url-parameters-with-javascript/
                // const queryString = window.location.search;
                // console.log(queryString);


                // params.toString(); // "foo=1&bar=2&baz=3"
                // document.location.search = params;

                

            
            // Update the current slider value (each time you drag the slider handle)
            slider.oninput = function() {
                output = this.value;
                document.getElementById("kuvakoko").style.width = output + "%";
                // params.set('kuvakoko',output);
                // window.history.replaceState(params, "Title", params);
                // window.history.pushState("object or string", "Title", window.location.href);
                

            } 
            sliderKuvakorkeus.oninput = function() {
                outputKuvakorkeus = this.value;
                document.getElementById("kuvakoko").style.marginTop = outputKuvakorkeus + "%";
                // params.set('kuvakorkeus',outputKuvakorkeus);
                // console.log("Kuvakorkeus: " + outputKuvakorkeus);
            } 
            slidertekstikorkeus.oninput = function() {
                outputTekstikorkeus = this.value;
                document.getElementsByClassName("tuote")[0].style.marginTop = outputTekstikorkeus + "%";
                // params.set('tekstikorkeus', outputTekstikorkeus);
                // console.log(outputTekstikorkeus);
            } 
            sliderkuvausteksti.oninput = function() {
                outputKuvausteksti = this.value;
                document.getElementsByClassName("kuvaus")[0].style.fontSize = outputKuvausteksti + "vh";
                document.getElementsByClassName("kuvaus")[0].style.lineHeight = "inherit";
                // params.set('kuvausteksti', outputKuvausteksti);
                // document.getElementsByClassName("kuvaus")[0].style.lineHeight = outputKuvausteksti * 1.2;
                // console.log(outputKuvausteksti);
            } 

            let asteet = 0;
            kaanna = function() {
                asteet = asteet + 90;
                let apuAsteet = "rotate(" + asteet + "deg)"
                document.getElementById("kuvakoko").style.transform= apuAsteet;
                // params.set('asteet',apuAsteet);
            }



           
            // Tarkistetaan tuliko kuva oikein. Jos ei, lisätään kuva-urlin perään "_1"
            window.addEventListener("load", event => {
            var image = document.querySelector('#kuvakoko');
            var isLoaded = image.complete && image.naturalHeight !== 0;

            // let apuri;
            // for (let index = 2; index < 10; index++) {
            //     apuri = image.src.replace(".jpg", `_${index}.jpg`);
                
            //     // console.log(apuri);
                
            //     let lisakuva = document.createElement("IMG");
            //     lisakuva.setAttribute("src", `${apuri}`)
            //     // lisakuva.setAttribute("width", `100`)
            //     lisakuva.setAttribute("class", `lisakuva`)
                
            //     lisakuva.addEventListener("load", function(){
            //         // alert(lisakuva.src + " " + this.naturalWidth +' '+ this.naturalHeight );
            //         // Mikäli lisäkuvalla on olemassa korkeusarvo, lisätään kuva dom:iin
            //         if (lisakuva.naturalHeight) {
            //             // alert(lisakuva.naturalHeight);
            //             // document.body.appendChild(lisakuva);
                        
            //             //mitä, mihin EI TOIMI
            //             document.body.append(lisakuva, getElementsByClassName('tausta'));
            //         }                   
            //     });

            // }

            
                if(!isLoaded) {
                    console.log(`Alkuperäistä kuvaa ${image.src} ei löytynyt.'`);
                    image.src = image.src.replace(".jpg", "_1.jpg");
                    document.querySelector('#kuvakoko').src = image.src;
                    console.log(`Lisätään urlin perään '_1.jpg ja yritetään ladata: ${image.src}`);
                }
                // EI TOIMI
                // if(image.src.includes("_1.jpg") && !isLoaded) {
                //     // Jos kuva _1.jpg ei toimi, vaihdetaan sen tilalle placeholder
                //     // jos ei toimi, korvataan se placeholderilla
                //     image.src = "https://www.minimani.fi/media/catalog/product/placeholder/default/minimaniph.png";
                //     document.querySelector('#kuvakoko').src = image.src;
                //     console.log("Palautetaan placeholder-kuva.");
                // }
               
            
            });

            


            // tarkistetaan onko "tulosta kehykset" valittuna
            tulostareunat = function() {
                if (document.querySelector('#tulostareunatcheckbox').innerHTML == "check_box_outline_blank") {
                    // console.log("Tulosta kehykset");
                    document.querySelector('.taustakuva').classList.remove('noprint');
                    document.querySelector('#tulostareunatcheckbox').innerHTML = "check_box";
                }
                else if (document.querySelector('#tulostareunatcheckbox').innerHTML == "check_box") {
                    document.querySelector('.taustakuva').classList.add('noprint');
                    document.querySelector('#tulostareunatcheckbox').innerHTML = "check_box_outline_blank";
                    // console.log("poista kehykset");
                }
            }

            // tarkistetaan onko "näytä viivakoodi" valittuna
            naytaviivakoodi = function() {
                if (document.querySelector('#naytaviivakoodicheckbox').innerHTML == "check_box_outline_blank") {
                    document.querySelector('.ean').style.visibility = 'hidden';
                    document.querySelector('.viivakoodi').style.visibility = 'initial';
                    document.querySelector('#naytaviivakoodicheckbox').innerHTML = "check_box";
                }
                else if (document.querySelector('#naytaviivakoodicheckbox').innerHTML == "check_box") {
                    document.querySelector('.ean').style.visibility = 'initial';
                    document.querySelector('.viivakoodi').style.visibility = 'hidden';
                    document.querySelector('#naytaviivakoodicheckbox').innerHTML = "check_box_outline_blank";
                }
            }

            // tarkistetaan onko "Uutuus-lätkä" ruksittuna
            naytauutuus = function() {
                if (document.querySelector('#naytauutuuscheckbox').innerHTML == "check_box_outline_blank") {
                    document.querySelector('.uutuus').style.visibility = 'initial';
                    document.querySelector('#naytauutuuscheckbox').innerHTML = "check_box";
                }
                else if (document.querySelector('#naytauutuuscheckbox').innerHTML == "check_box") {
                    document.querySelector('.uutuus').style.visibility = 'hidden';
                    document.querySelector('#naytauutuuscheckbox').innerHTML = "check_box_outline_blank";
                }
            }

            // skaalataan esikatselukuvaa
            let skaalaus = 78;
            skaalaaesikatselua = function(kerroin) {
                kerroin = parseFloat(kerroin);
                // console.log("Kerroin ", kerroin + " * " + skaalaus + " = " + skaalaus*kerroin);
                skaalaus = skaalaus * kerroin;
                document.querySelector('.tausta').style.transform = `scale(${skaalaus}%)`;
                // -webkit-transform:scale(0.9, 0.9); Safarissa toimis tämä?

            }

            vaihdaKuvanUrl = function() {
                let url = window.prompt("Vaihtaaksesi toisen kuvan (png tai jpg), anna sen url-osoite: ", document.querySelector('#kuvakoko').src);

                if (url == null) {
                    url=document.querySelector('#kuvakoko').src;
                    console.log("Ei vaihdettu kuvaa: " + url);
                }
                // prompt OK palauttaa syötetyn arvon, CANCEL palauttaa null:in
                else if (url !== null && url.includes("jpg") || url.includes("png")) {
                    document.querySelector('#kuvakoko').src = url;
                    console.log("Vaihdettiin kuva: " + url);
                }

            }

            lisakuvat = function() {
               
                // selvittää kutsuttaessa kuvan päätteen .jpg tai .png
                function getFileFormat(kuvanosoite) {
                    var fileName = kuvanosoite.split('/').pop();
                    var fileFormat = fileName.split('.').pop();
                    // console.log("Kuvan formaatti: "+fileFormat);
                    return fileFormat;
                }   
                
                let lisakuva = [];
                let kuvanosoite = document.querySelector('#kuvakoko').src; // https://www.minimani.fi/media/catalog/product/7/3/7320065006575.jpg
                let kuvanPaate = getFileFormat(kuvanosoite); // kutsutaan yo. funktiota ja selvitetään kuvan pääte .jpg tai .png
                let kuvanosoiteIlmanPaatetta = kuvanosoite.replace("." + kuvanPaate, '');
                

                // Lisätään ekaksi lisäkuvaksi peruskuva, jotta se voidaan vaihtaa lappuun takaisin lisäkuvan klikkaamisen jälkeen:
                let imgLisakuva = document.createElement("img");
                imgLisakuva.src = kuvanosoite;
                imgLisakuva.title = 'Klikkaa kuvaa vaihtaaksesi sen hintalappuun';
                imgLisakuva.onclick = function() {vaihdaLisakuva(kuvanosoite); }
                document.querySelector('#lisakuvat').appendChild(imgLisakuva);


                // käydään läpi maks. 20 lisäkuvaa
                for (let index = 1; index < 20; index++) {
                    lisakuva.push(kuvanosoiteIlmanPaatetta + "_" + index + "." + kuvanPaate);
                    // console.log(lisakuva[index-1]);
                    
                    const img = new Image();
                    img.onload = function() {
                        // alert(this.width + 'x' + this.height);
                        
                        // Ja sitten lisäkuviin:
                        // jos lisäkuva ei sisällä placeholder-kuvaa ja sen korkeus ei ole 1220 px (=placeholderin mitat), lisää se lisäkuvaksi
                        if (!lisakuva[index-1].includes("minimaniph") && this.width != 1220) {
                            // console.log("Lisäkuva: "+lisakuva[index-1]);
                            imgLisakuva = document.createElement("img");
                            imgLisakuva.src = lisakuva[index-1];
                            imgLisakuva.title = 'Klikkaa kuvaa vaihtaaksesi sen hintalappuun';
                            // ESIMERKKI PARAMETRISTA: link.onclick = function() { loadScript(it_is_here); }
                            imgLisakuva.onclick = function() {vaihdaLisakuva(lisakuva[index-1]); }
                            document.querySelector('#lisakuvat').appendChild(imgLisakuva);
                        }
                        // Jos lisäkuvia ei ole (#lisakuvat-divissä on lapsielementtejä vain 1), poista koko lisäkuvat-div.
                        else if (document.querySelectorAll('#lisakuvat img').length == 1) {
                            console.log("Lisäkuvia ei ollut. Poistetaan lisakuvat-div");
                            
                            // ESIMERKKI
                            // let node = document.getElementById("nested");
                            // if (node.parentNode) {
                                // node.parentNode.removeChild(node);
                                // }
                                let node = document.querySelector('#lisakuvat');
                                if (node.parentNode) {
                                    node.parentNode.removeChild(node);
                                }
                            }
                        } // END img.onload()
                        img.src = lisakuva[index-1];
                    }
                    
                    
                } // END lisakuvat()
                
                console.log("Ladataan lisäkuvat");
                lisakuvat(); // Ladataan mahdolliset lisäkuvat valikon alle
                
                
                
    vaihdaLisakuva = function(lisakuvanOsoite) {
        document.querySelector('#kuvakoko').src = lisakuvanOsoite;
        // console.log("Vaihdettu kuvaksi: " + lisakuvanOsoite);
    }


            </script>


    </body>
    </html>